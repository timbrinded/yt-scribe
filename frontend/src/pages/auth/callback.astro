---
import LandingLayout from '../../layouts/LandingLayout.astro';

// This page handles OAuth callback errors
// On success, the backend redirects directly to /library
// This page is shown if there's an error in the OAuth flow

const error = Astro.url.searchParams.get('error');
const errorDescription = Astro.url.searchParams.get('error_description');
---

<LandingLayout title="Authentication - YTScribe">
	<div class="flex min-h-screen items-center justify-center px-4">
		<div class="w-full max-w-md text-center">
			{error ? (
				<>
					<div class="mb-6 flex h-16 w-16 mx-auto items-center justify-center rounded-full bg-error-500/10">
						<svg
							class="h-8 w-8 text-error-500"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
							stroke-width="1.5"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"
							/>
						</svg>
					</div>
					<h1 class="text-2xl font-bold text-neutral-900 mb-2">Authentication Failed</h1>
					<p class="text-neutral-500 mb-6">
						{errorDescription || "There was a problem signing you in. Please try again."}
					</p>
					<div class="flex flex-col gap-3">
						<a
							href="/login"
							class="inline-flex items-center justify-center gap-2 rounded-lg bg-primary-600 px-6 py-3 font-medium text-white shadow-sm transition-all hover:bg-primary-700 hover:shadow-md"
						>
							Try Again
						</a>
						<a
							href="/"
							class="inline-flex items-center justify-center gap-2 rounded-lg px-6 py-3 font-medium text-neutral-600 transition-all hover:text-neutral-900"
						>
							Go to Home
						</a>
					</div>
				</>
			) : (
				<>
					{/* Loading state while redirecting */}
					<div class="mb-6 flex h-16 w-16 mx-auto items-center justify-center rounded-full bg-primary-100">
						<svg
							class="h-8 w-8 text-primary-600 animate-spin"
							fill="none"
							viewBox="0 0 24 24"
						>
							<circle
								class="opacity-25"
								cx="12"
								cy="12"
								r="10"
								stroke="currentColor"
								stroke-width="4"
							/>
							<path
								class="opacity-75"
								fill="currentColor"
								d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
							/>
						</svg>
					</div>
					<h1 class="text-2xl font-bold text-neutral-900 mb-2">Signing you in...</h1>
					<p class="text-neutral-500">Please wait while we complete the authentication.</p>
				</>
			)}
		</div>
	</div>
</LandingLayout>
