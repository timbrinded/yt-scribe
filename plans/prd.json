{
	"name": "YTScribe - YouTube Video Knowledge Base with LLM Chat",
	"quality_gates": ["bun run typecheck", "bun test", "bun run lint"],
	"tasks": [
		{
			"category": "functional",
			"description": "[Effect-TS] Create Live and Test layer compositions (DI wiring)",
			"steps": [
				"Create `src/effect/layers/Live.ts`",
				"Compose leaf services: Layer.mergeAll(Database.Live, OpenAI.Live, YouTube.Live, Progress.Live)",
				"Compose dependent services: Transcription.Live, Chat.Live, Auth.Live with Layer.provide(LeafLayer)",
				"Compose orchestration: Pipeline.Live.pipe(Layer.provide(Layer.merge(LeafLayer, DependentLayer)))",
				"Export LiveLayer and AppRequirements type",
				"Create `src/effect/layers/Test.ts` with makeTestLayer() factory accepting partial mocks",
				"Run `bun run typecheck`"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Create main entry point with BunRuntime",
			"steps": [
				"Create `src/effect/main.ts`",
				"Build HTTP server layer with HttpApiBuilder.serve, middlewareCors, BunHttpServer.layer",
				"Launch with BunRuntime.runMain(Layer.launch(HttpLive))",
				"Run `bun run typecheck`",
				"Test: `bun src/effect/main.ts` starts server on port 3001"
			],
			"passes": false
		},
		{
			"category": "reliability",
			"description": "[Effect-TS] Add graceful shutdown handling",
			"steps": [
				"In main.ts, handle SIGINT and SIGTERM signals",
				"Use Effect.addFinalizer in Database layer to close SQLite connection",
				"Ensure PubSub is properly cleaned up on shutdown",
				"Test: Start server, send SIGINT, verify clean shutdown logs"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Serve frontend static files",
			"steps": [
				"Add static file serving to API for frontend assets",
				"Use HttpRouter.mountApp or platform file serving utilities",
				"Configure to serve from frontend/dist in production",
				"Add fallback to index.html for SPA routing",
				"Test: Build frontend, start server, verify pages load"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Remove Elysia and old service files",
			"steps": [
				"Delete src/server.ts (old Elysia entry)",
				"Delete src/routes/*.ts (old Elysia routes)",
				"Delete src/middleware/*.ts (old Elysia middleware)",
				"Delete src/services/*.ts (old service implementations)",
				"Delete src/auth/*.ts (old OAuth implementation)",
				"Update package.json scripts to use src/effect/main.ts",
				"Remove elysia and @elysiajs/* from dependencies",
				"Run `bun run typecheck`",
				"Run `bun test`"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Update package.json scripts",
			"steps": [
				"Change dev: bun --hot src/effect/main.ts",
				"Change start: bun src/effect/main.ts",
				"Verify `bun run dev` starts Effect server with HMR",
				"Verify `bun run start` starts production server"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Create test layer infrastructure",
			"steps": [
				"Run `bun add -d @effect/vitest`",
				"Update src/effect/layers/Test.ts to export makeTestLayer factory",
				"Create default mock implementations: Database.Test, OpenAI.Test, YouTube.Test, Progress.Test, Transcription.Test, Chat.Test",
				"Run `bun run typecheck`"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Add Pipeline service unit tests with mock DI",
			"steps": [
				"Create `tests/effect/services/Pipeline.test.ts`",
				"Create test-specific mock layers for YouTube, Transcription",
				"Compose test layer replacing real services: makeTestLayer({ youtube: MockYouTube, transcription: MockTranscription })",
				"Write tests using Effect.provide(TestLayer)",
				"Test: processVideo succeeds with mocked services",
				"Test: processVideo returns VideoNotFoundError for missing video",
				"Test: processVideo marks video as failed on transcription error",
				"Run `bun test tests/effect/services/`"
			],
			"passes": false
		},
		{
			"category": "functional",
			"description": "[Effect-TS] Add API integration tests with full test layer",
			"steps": [
				"Create `tests/effect/api/videos.test.ts`",
				"Use makeTestLayer() to create fully mocked environment",
				"Use Effect HttpClient to make requests against test server",
				"Test: POST /videos creates video and returns 201",
				"Test: POST /videos returns 400 for invalid YouTube URL",
				"Test: GET /videos returns user's videos only",
				"Test: Unauthorized request returns 401",
				"Run `bun test tests/effect/api/`"
			],
			"passes": false
		},
		{
			"category": "observability",
			"description": "Add basic analytics tracking",
			"steps": [
				"Create analytics table: id, userId, event, properties (JSON), createdAt",
				"Add trackEvent(userId, event, properties) function",
				"Track: video_added, transcription_completed, chat_message_sent",
				"Create admin endpoint GET /api/admin/analytics (protected)",
				"Verify events are recorded"
			],
			"passes": false
		}
	]
}
